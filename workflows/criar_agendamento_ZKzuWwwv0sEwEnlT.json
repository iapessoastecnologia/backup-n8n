{"createdAt":"2025-08-07T12:02:07.836Z","id":"ZKzuWwwv0sEwEnlT","name":"criar_agendamento","active":false,"isArchived":false,"nodes":[{"parameters":{"workflowInputs":{"values":[{"name":"user_phone"},{"name":"start_date_time"},{"name":"end_date_time"},{"name":"professional_id"},{"name":"service_id"}]}},"type":"[REDACTED]","typeVersion":1.1,"position":[-480,0],"id":"5359cdaa-a4b0-43b9-98a2-79818dd343f8","name":"Start"},{"parameters":{"operation":"get","tableId":"Users","filters":{"conditions":[{"keyName":"[REDACTED]","keyValue":"[REDACTED]"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-256,0],"id":"c09be2d7-2d1d-40f9-b1e4-412b678cbc76","name":"pega_usuario"},{"parameters":{"operation":"get","tableId":"Professionals","filters":{"conditions":[{"keyName":"[REDACTED]","keyValue":"[REDACTED]"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-48,0],"id":"c188aec8-7859-4562-884b-e80406bb6a5f","name":"pega_profissional","alwaysOutputData":true},{"parameters":{"tableId":"Appointments","fieldsUi":{"fieldValues":[{"fieldId":"start_date_time","fieldValue":"={{ $('Start').item.json.start_date_time }}"},{"fieldId":"end_date_time","fieldValue":"={{ $('Start').item.json.end_date_time }}"},{"fieldId":"user_id","fieldValue":"={{ $('pega_usuario').item.json.id }}"},{"fieldId":"service_id","fieldValue":"={{ $('Start').item.json.service_id}}"},{"fieldId":"professional_id","fieldValue":"={{ $('pega_profissional').item.json.id }}"},{"fieldId":"status","fieldValue":"confirmed"},{"fieldId":"calendar_event_id","fieldValue":"0"},{"fieldId":"notification_date_time","fieldValue":"={{ DateTime.fromISO($('Start').item.json.start_date_time).minus({minutes:60}).toISO()}}"},{"fieldId":"notificated","fieldValue":"={{ \nDateTime.fromISO($('Start').item.json.start_date_time)\n.diff( \nDateTime.now().setZone('America/Sao_Paulo'),\n'minutes'\n).minutes <= 60 \n}}"},{"fieldId":"created_at","fieldValue":"={{ $now }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[224,0],"id":"2bfd7604-c371-4261-93a6-3e11801f58a2","name":"criar_agendamento"},{"parameters":{"calendar":{"__rl":true,"value":"[REDACTED]","mode":"list","cachedResultName":"IAConsultas"},"start":"={{ $('Start').item.json.start_date_time }}","end":"={{ $('Start').item.json.end_date_time }}","additionalFields":{"attendees":["={{ $('pega_usuario').item.json.email }}, {{ $('pega_profissional').item.json.email }}"],"summary":"=Consulta de {{ $('pega_usuario').item.json.name }} com {{ $('pega_profissional').item.json.name }}"}},"type":"n8n-nodes-base.googleCalendar","typeVersion":1.3,"position":[480,0],"id":"97b001ef-8937-4e22-b079-ef14c4aaafbd","name":"Google Calendar"},{"parameters":{"operation":"update","tableId":"Appointments","filters":{"conditions":[{"keyName":"[REDACTED]","condition":"eq","keyValue":"[REDACTED]"}]},"fieldsUi":{"fieldValues":[{"fieldId":"calendar_event_id","fieldValue":"={{ $json.id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[704,0],"id":"c0453ed3-8f84-421f-9104-6d01ba061a4e","name":"inclui calender_id do evento no db"},{"parameters":{"assignments":{"assignments":[{"id":"3fc3c223-8504-4038-93ad-2fc8a485435f","name":"status","value":"success","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[944,0],"id":"243410e6-a929-41f2-b15d-d863c70d9120","name":"Resposta: Sucesso"}],"connections":{"Start":{"main":[[{"node":"pega_usuario","type":"main","index":0}]]},"pega_usuario":{"main":[[{"node":"pega_profissional","type":"main","index":0}]]},"pega_profissional":{"main":[[{"node":"criar_agendamento","type":"main","index":0}]]},"criar_agendamento":{"main":[[{"node":"Google Calendar","type":"main","index":0}]]},"Google Calendar":{"main":[[{"node":"inclui calender_id do evento no db","type":"main","index":0}]]},"inclui calender_id do evento no db":{"main":[[{"node":"Resposta: Sucesso","type":"main","index":0}]]}}}