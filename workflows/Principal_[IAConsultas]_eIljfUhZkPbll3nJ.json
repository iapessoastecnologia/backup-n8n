{"createdAt":"2025-08-05T13:17:19.495Z","updatedAt":"2025-09-30T12:22:30.224Z","id":"eIljfUhZkPbll3nJ","name":"Principal [IAConsultas]","active":false,"isArchived":false,"nodes":[{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[1280,672],"id":"324ddb4a-f529-451c-aadb-2e7d7cfd9447","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"Xbn3th2PsGCRkOUs","name":"CHAVE TESTE C MARINHO"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('entrada_formatada').item.json.phone\n   + '-' + ($('entrada_whatsapp').item.json.body.instance || 'default')\n   + '-' + ($json.conversation_id || 'global') }}","contextWindowLength":12},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[1408,672],"id":"34ea2301-a0d9-4af1-97b9-68284ca4eacf","name":"Simple Memory"},{"parameters":{"operation":"get","tableId":"Professionals","filters":{"conditions":[{"keyName":"phone","keyValue":"={{ $json.phone }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[752,448],"id":"318176f9-ae04-4e5c-b40a-3e9cebe709df","name":"pega_profissional","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"YXkD4rzxC3ARktn0","name":"Supabase IAPessoasAgenteConsulta"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"d8166451-df23-4d2c-ac53-4bc77ba26c06","leftValue":"={{ !!$json.id }}","rightValue":true,"operator":{"type":"boolean","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[960,448],"id":"b1a7d927-504d-4bef-935e-496bd2785b35","name":"é_profissional?"},{"parameters":{"operation":"get","tableId":"Users","filters":{"conditions":[{"keyName":"phone","keyValue":"={{ $('entrada_formatada').item.json.phone }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[1200,528],"id":"20408a60-42b6-4e5d-b15e-3a436ff65aa8","name":"pega_usuario","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"YXkD4rzxC3ARktn0","name":"Supabase IAPessoasAgenteConsulta"}}},{"parameters":{"toolDescription":"Pega:\n- dados do usuário\n- seus agendamentos\n","url":"=https://xngqhwlansqbwsunnkvl.supabase.co/rest/v1/Users?phone=eq.{{ $('entrada_formatada').item.json.phone }}&select=id,name,phone,Appointments(id,start_date_time,end_date_time,status,Services(name),Professionals(name))&Appointments.start_date_time=gt.{{ $now.toString() }}\n\n\n\n","authentication":"predefinedCredentialType","nodeCredentialType":"supabaseApi","options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[1536,672],"id":"3c9c4e97-8d4c-4c9c-9fa6-120bdb66d12f","name":"pega_usuario_com_agendamentos","credentials":{"supabaseApi":{"id":"YXkD4rzxC3ARktn0","name":"Supabase IAPessoasAgenteConsulta"}}},{"parameters":{"assignments":{"assignments":[{"id":"fbb2bd53-b3a8-4d8e-9fa4-249c5dccff65","name":"message","value":"={{ $('entrada_whatsapp').item.json.body.data.message.conversation }}","type":"string"},{"id":"f3088102-4730-48ec-8e56-503fef440a3d","name":"phone","value":"={{ $('entrada_whatsapp').item.json.body.data.key.remoteJid.split('@')[0] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[528,448],"id":"aa7b7df5-3e84-4eb7-84e0-0a28760273bd","name":"entrada_formatada"},{"parameters":{"toolDescription":"Pega:\n- dados dos profissionais\n- dados dos serviços","url":"=https://xngqhwlansqbwsunnkvl.supabase.co/rest/v1/Professionals?active=eq.true&select=id,name,email,phone,description,expertise,ProfessionalServices(service:Services(id,name,duration_minutes))","authentication":"predefinedCredentialType","nodeCredentialType":"supabaseApi","options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[1744,672],"id":"6283c7bc-1f7a-4db4-ae61-36582e321e5b","name":"pega_profissionais_com_servicos","credentials":{"supabaseApi":{"id":"YXkD4rzxC3ARktn0","name":"Supabase IAPessoasAgenteConsulta"}}},{"parameters":{"toolDescription":"Cria novo usuário no sistema com:\n- nome\n- telefone\n- e-mail","method":"POST","url":"https://xngqhwlansqbwsunnkvl.supabase.co/rest/v1/Users?on_conflict=phone","authentication":"predefinedCredentialType","nodeCredentialType":"supabaseApi","sendBody":true,"bodyParameters":{"parameters":[{"name":"name","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"},{"name":"phone","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters1_Value', ``, 'string') }}"},{"name":"email","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters2_Value', ``, 'string') }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[1936,672],"id":"839a5f5b-6fa8-49ff-bb5b-0bab9c3882fb","name":"cria_usuario","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"YXkD4rzxC3ARktn0","name":"Supabase IAPessoasAgenteConsulta"}}},{"parameters":{"toolDescription":"Pega:\n- futuros agendamentos do profissional\n","url":"=https://xngqhwlansqbwsunnkvl.supabase.co/rest/v1/Professionals?id=eq.{{ $('pega_profissional').first().json.id }}&select=id,name,Appointments(start_date_time,end_date_time,status,Users(name),Services(name))&Appointments.start_date_time=gt.{{ $now.toString() }}","authentication":"predefinedCredentialType","nodeCredentialType":"supabaseApi","options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[2144,672],"id":"c286b4ab-71cd-4bc6-98a0-ec8d1d0dbafb","name":"pega_agendamentos_do_profissional","credentials":{"supabaseApi":{"id":"YXkD4rzxC3ARktn0","name":"Supabase IAPessoasAgenteConsulta"}}},{"parameters":{"description":"Função principal para criar agendamento","workflowId":{"__rl":true,"value":"ZKzuWwwv0sEwEnlT","mode":"list","cachedResultName":"criar_agendamento"},"workflowInputs":{"mappingMode":"defineBelow","value":{"user_phone":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('user_phone', ``, 'string') }}","start_date_time":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('start_date_time', `timestamptz\n* Timezone São Paulo\n`, 'string') }}","end_date_time":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('end_date_time', `timestamptz\n* Timezone São Paulo\n`, 'string') }}","professional_id":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('professional_id', ``, 'string') }}","service_id":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('service_id', ``, 'string') }}"},"matchingColumns":[],"schema":[{"id":"user_phone","displayName":"user_phone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"start_date_time","displayName":"start_date_time","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"end_date_time","displayName":"end_date_time","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"professional_id","displayName":"professional_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"service_id","displayName":"service_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[2464,672],"id":"22d28107-2248-42dc-bbeb-deacd21bf79f","name":"criar_agendamento"},{"parameters":{"description":"Chame essa função quando for cancelar um agendamento.\nPara cancelar, busque e use o ID do agendamento","workflowId":{"__rl":true,"value":"rJ0iIfdWHdgiiTHq","mode":"list","cachedResultName":"cancelar_agendamento"},"workflowInputs":{"mappingMode":"defineBelow","value":{"appointment_id":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('appointment_id', `use o ID do agendamento que você pegou `, 'string') }}"},"matchingColumns":["appointment_id"],"schema":[{"id":"appointment_id","displayName":"appointment_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[2672,672],"id":"03775a63-7e27-4ade-ad0c-9af485625b75","name":"cancelar_agendamento"},{"parameters":{"description":"IA especializada em consultar, criar, atualizar ou remover dados do banco.\nExemplos de uso:\n- Ver profissionais ativos e seus serviços\n- Atualizar informações de um profissional\n- Criar novos serviços ou agendamentos\n- Remover registros quando necessário","workflowId":{"__rl":true,"value":"sMp9fq5pHs7ifE0e","mode":"list","cachedResultName":"agente_db_admin"},"workflowInputs":{"mappingMode":"defineBelow","value":{"is_admin":"={{ $('pega_profissional').all().length\n > 0 && $('pega_profissional').first().json.is_admin === true }}","prompt":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('prompt', ``, 'string') }}","phone":"={{ $('entrada_formatada').item.json.phone }}"},"matchingColumns":[],"schema":[{"id":"prompt","displayName":"prompt","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"is_admin","displayName":"is_admin","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"boolean"},{"id":"phone","displayName":"phone","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[2912,672],"id":"15a1030d-a32e-4b06-be54-0a3f334af759","name":"agente_db_admin"},{"parameters":{"promptType":"define","text":"=- Mensagem: {{ $('entrada_formatada').item.json.message }}","options":{"systemMessage":"=Você é uma IA especializada em agendamentos da IAPessoas. Sua missão é atender o usuário do sistema de forma cordial, guiada e eficiente, respeitando as regras do sistema e o papel de acesso do interlocutor.\n\n---\n\nPapel do usuário: {{\n  $('pega_profissional').first().json[\"id\"]\n    ? ($('pega_profissional').first().json.is_admin === true ? 'admin' : 'profissional')\n    : 'cliente'\n}}\n\n{{ $('pega_usuario').isExecuted && $('pega_usuario').first().json ? 'Dados do usuário:\\\\n' + JSON.stringify($('pega_usuario').first().json) : '' }}\n\n{{ $('pega_profissional').first().json ? 'Dados do profissional:\\\\n' + JSON.stringify($('pega_profissional').first().json) : '' }}\n\n---\n\nComportamento por papel\n\nSe papel = admin:\n- Pode gerenciar agendamentos, usuários, profissionais e serviços\n- Pode analisar dados e usar qualquer ferramenta\n\nSe papel = profissional:\n- Pode visualizar seus agendamentos (use a função pega_agendamentos_do_profissional)\n- Consultar disponibilidade e serviços\n- Criar ou cancelar agendamentos onde ele seja o profissional\n\nSe papel = cliente:\n- Pode apenas criar e cancelar seus próprios agendamentos\n- Pode consultar disponibilidade e serviços\n- Nunca deve acessar dados de outros usuários\n- Nunca deve acionar tools como agente_db_admin ou qualquer função administrativa\n\n---\n\nVerificação de cadastro\n\nAntes de criar ou cancelar agendamentos:\n- Verifique se o usuário está cadastrado (via pega_usuario)\n- Se não estiver:\n  - Para criar agendamento: solicite nome, telefone e e-mail, depois use criar_usuario\n  - Para cancelar: diga “Você ainda não possui nenhum agendamento ativo para ser cancelado” e finalize\n\n---\n\nInício da conversa\n\nCumprimente o usuário pelo primeiro nome (se disponível). Explique brevemente as funcionalidades disponíveis, com base no papel identificado:\n- admin: acesso total\n- profissional: foco em seus atendimentos\n- cliente: foco em criar/cancelar suas próprias consultas\n\n---\n\nRestrições de escopo e comportamento fora de contexto\nSe o usuário fizer perguntas que não estejam relacionadas ao sistema IAPessoas, como curiosidades, esportes, política, etc:\n\nResponda com:\n\"Desculpe, fui programado apenas para ajudar com agendamentos e informações relacionadas ao sistema IAPessoas. Para outras dúvidas, consulte um assistente geral.\"\n\nNunca tente responder temas fora do seu domínio.\n\n\nFluxo para criação de agendamento\n\n1. Pergunte se o usuário quer escolher por serviço ou profissional\n2. Se escolher serviço:\n   - Liste serviços ativos\n   - Depois, profissionais que atendem esse serviço\n3. Se escolher profissional:\n   - Liste profissionais ativos\n   - Depois, serviços realizados por ele\n   - Salve o ID do profissional que o usuário escolher e utilize nas ferramentas \n4. Solicite data e horário desejado (formato livre)\n5. Verifique disponibilidade\n6. Se indisponível, ofereça sugestões próximas\n7. Antes de criar, confirme cadastro\n8. Apresente resumo antes da confirmação\n\n---\n\nRegras gerais\n\n- Nunca solicite IDs manualmente\n- Apenas cliente pode mexer em seus próprios dados\n- Permita atualização de agendamento se houver confirmação\n- Respeite o escopo de acesso conforme o papel\n\n---\n\nEsquema de dados\n\nAppointments:\nid, created_at, user_id, service_id, start_date_time, end_date_time, status, calendar_event_id, notification_date_time, notificated, professional_id, notes\n\nProfessionalServices:\nid, professional_id, service_id\n\nProfessionals:\nid, name, email, phone, is_admin, description, expertise, active\n\nServices:\nid, name, description, duration_minutes, active\n\nUsers:\nid, name, phone, email\n\n---\n\nTools disponíveis\n\n- criar_usuario, criar_agendamento, cancelar_agendamento, consulta_disponibilidade\n- pega_usuario_com_agendamentos, pega_profissionais_com_servicos, pega_agendamentos_do_profissional\n- (Somente admin) agente_db_admin\n\n---\n\nContexto da interação\n\nContexto atual da interação\n- Usuário: {{ $('pega_usuario').isExecuted && $('pega_usuario').first().json ? $('pega_usuario').first().json.name : 'não identificado' }}\n- Profissional: {{ $('pega_profissional').first().json ? $('pega_profissional').first().json.name : 'não identificado' }}\n- Telefone: {{ $('entrada_formatada').item.json.phone }}\n- Data/hora atual: {{ $now }}\n- Timezone: América/São_Paulo"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[1664,432],"id":"51b18b68-acf0-4a1c-afac-4ae846632ecd","name":"Agente assistente de agendamento"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"710588c2-52d0-433d-a580-85e39f4bdd08","leftValue":"={{ $json.body.data.key.remoteJid }}","rightValue":"557592991249@s.whatsapp.net","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"a3a9502b-9926-4002-85ce-3bdba946107e","leftValue":"={{ $json.body.data.key.remoteJid }}","rightValue":"=557592239427@s.whatsapp.net","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[-672,432],"id":"e13482f5-cae0-4da8-a2d7-c3d4cd563486","name":"só_meu_numero_passa"},{"parameters":{"resource":"messages-api","instanceName":"={{ $('entrada_whatsapp').item.json.body.instance }}","remoteJid":"={{ $('entrada_whatsapp').item.json.body.data.key.remoteJid.split('@')[0] }}","messageText":"={{ $json.output }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[2096,432],"id":"18f61eaa-0499-406d-9911-099275ec3916","name":"Evolution API","credentials":{"evolutionApi":{"id":"BOdDN0nhnxIv749g","name":"Evolution Financeiro"}}},{"parameters":{"httpMethod":"POST","path":"evolution-api","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-880,432],"id":"8ecd6571-8775-49d2-b123-cd3e2d684cf1","name":"entrada_whatsapp","webhookId":"d837255f-ccbc-4117-b8bb-9cbadfd3be47"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f695f916-4d07-4bcf-8ef2-f2e518b5fdba","leftValue":"={{ $json.body.data.messageType }}","rightValue":"audioMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-400,432],"id":"aa8844d1-1559-4520-bf83-8a752f079ec4","name":"é_um_audio_?"},{"parameters":{"workflowId":{"__rl":true,"value":"5Ugz07XUD7Hj8OOs","mode":"list","cachedResultName":"áudio_para_texto"},"workflowInputs":{"mappingMode":"defineBelow","value":{"message_id":"={{ $('entrada_whatsapp').item.json.body.data.key.id }}","instance":"={{ $('entrada_whatsapp').item.json.body.instance }}"},"matchingColumns":[],"schema":[{"id":"message_id","displayName":"message_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"instance","displayName":"instance","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-64,320],"id":"df161c36-a69e-4c1d-9b0e-1e103e67124f","name":"audio_para_texto"},{"parameters":{"description":"Função para consulta de disponibilidade de horários","workflowId":{"__rl":true,"value":"35ZK3bQrEy5cHrYZ","mode":"list","cachedResultName":"consulta_disponibilidade"},"workflowInputs":{"mappingMode":"defineBelow","value":{"start_time":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('start_time', `timestampz\n`, 'string') }}","end_time":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('end_time', `timestampz`, 'string') }}","professional_id":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('professional_id', `UUID do Profissional`, 'string') }}"},"matchingColumns":[],"schema":[{"id":"start_time","displayName":"start_time","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"end_time","displayName":"end_time","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"professional_id","displayName":"professional_id","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[2304,672],"id":"3a3d361c-e1de-420e-bca6-aefce222df20","name":"consulta_disponibilidade"}],"connections":{"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Agente assistente de agendamento","type":"ai_languageModel","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"Agente assistente de agendamento","type":"ai_memory","index":0}]]},"pega_profissional":{"main":[[{"node":"é_profissional?","type":"main","index":0}]]},"é_profissional?":{"main":[[{"node":"Agente assistente de agendamento","type":"main","index":0}],[{"node":"pega_usuario","type":"main","index":0}]]},"pega_usuario":{"main":[[{"node":"Agente assistente de agendamento","type":"main","index":0}]]},"pega_usuario_com_agendamentos":{"ai_tool":[[{"node":"Agente assistente de agendamento","type":"ai_tool","index":0}]]},"entrada_formatada":{"main":[[{"node":"pega_profissional","type":"main","index":0}]]},"pega_profissionais_com_servicos":{"ai_tool":[[{"node":"Agente assistente de agendamento","type":"ai_tool","index":0}]]},"cria_usuario":{"ai_tool":[[{"node":"Agente assistente de agendamento","type":"ai_tool","index":0}]]},"pega_agendamentos_do_profissional":{"ai_tool":[[{"node":"Agente assistente de agendamento","type":"ai_tool","index":0}]]},"criar_agendamento":{"ai_tool":[[{"node":"Agente assistente de agendamento","type":"ai_tool","index":0}]]},"cancelar_agendamento":{"ai_tool":[[{"node":"Agente assistente de agendamento","type":"ai_tool","index":0}]]},"agente_db_admin":{"ai_tool":[[{"node":"Agente assistente de agendamento","type":"ai_tool","index":0}]]},"Agente assistente de agendamento":{"main":[[{"node":"Evolution API","type":"main","index":0}]]},"só_meu_numero_passa":{"main":[[{"node":"é_um_audio_?","type":"main","index":0}]]},"entrada_whatsapp":{"main":[[{"node":"só_meu_numero_passa","type":"main","index":0}]]},"é_um_audio_?":{"main":[[{"node":"audio_para_texto","type":"main","index":0}],[{"node":"entrada_formatada","type":"main","index":0}]]},"audio_para_texto":{"main":[[{"node":"entrada_formatada","type":"main","index":0}]]},"consulta_disponibilidade":{"ai_tool":[[{"node":"Agente assistente de agendamento","type":"ai_tool","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"entrada_whatsapp":[{"json":{"headers":{"host":"webhook.iapessoas.com.br","user-agent":"axios/1.10.0","content-length":"962","accept":"application/json, text/plain, */*","accept-encoding":"gzip, br","cdn-loop":"cloudflare; loops=1","cf-connecting-ip":"147.93.66.91","cf-ipcountry":"BR","cf-ray":"978cdf0ffba8af08-GRU","cf-visitor":"{\"scheme\":\"https\"}","content-type":"application/json","x-forwarded-for":"172.71.6.42","x-forwarded-host":"webhook.iapessoas.com.br","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"abfe0f8f798e","x-real-ip":"172.71.6.42"},"params":{},"query":{},"body":{"event":"messages.upsert","instance":"IAPessoas","data":{"key":{"remoteJid":"557592239427@s.whatsapp.net","fromMe":false,"id":"6AD543AA29E81B4D5D0635123B956284","senderLid":"944926421193@lid"},"pushName":"Davi Araujo","status":"DELIVERY_ACK","message":{"conversation":"Quero cancelar esse agendamento","messageContextInfo":{"deviceListMetadata":{"senderKeyHash":"pv4Q5JpnZBZHmA==","senderTimestamp":"1756778003","recipientKeyHash":"1m4i5CeYSHMQQQ==","recipientTimestamp":"1755545657"},"deviceListMetadataVersion":2,"messageSecret":"VeyYxmmOoxrOaJuB1gHq+aQEJLNrOAy1adAcQCgAT0c="}},"messageType":"conversation","messageTimestamp":1756814681,"instanceId":"ea1ea01b-791d-40b5-9e92-282321d4aea3","source":"android"},"destination":"https://webhook.iapessoas.com.br/webhook/evolution-api","date_time":"2025-09-02T09:04:41.574Z","sender":"557199997790@s.whatsapp.net","server_url":"https://api-evolution.iapessoas.com.br","apikey":"92F5F9CF053F-4488-B1C7-DB1AEA7B29D7"},"webhookUrl":"https://webhook.iapessoas.com.br/webhook/evolution-api","executionMode":"production"}}],"audio_para_texto":[{"json":{"name":"First item","code":1}},{"json":{"name":"Second item","code":2}}]},"versionId":"1f332032-7a4b-4797-9a66-916cd086837b","triggerCount":1,"shared":[{"createdAt":"2025-08-05T13:17:19.495Z","updatedAt":"2025-08-05T13:17:19.495Z","role":"workflow:owner","workflowId":"eIljfUhZkPbll3nJ","projectId":"g8BnYlos8HJUUVcr","project":{"createdAt":"2025-05-28T13:28:04.746Z","updatedAt":"2025-05-28T13:31:33.202Z","id":"g8BnYlos8HJUUVcr","name":"IA Pessoas <comercial@castelobrancocontabilidade.com.br>","type":"personal","icon":null,"description":null,"projectRelations":[{"createdAt":"2025-05-28T13:28:04.746Z","updatedAt":"2025-05-28T13:28:04.746Z","userId":"17ee4480-754a-4392-9fc2-a6bc3c46ebad","projectId":"g8BnYlos8HJUUVcr","user":{"createdAt":"2025-05-28T13:28:03.022Z","updatedAt":"2025-10-08T03:00:53.489Z","id":"17ee4480-754a-4392-9fc2-a6bc3c46ebad","email":"comercial@castelobrancocontabilidade.com.br","firstName":"IA","lastName":"Pessoas","personalizationAnswers":{"version":"v4","personalization_survey_submitted_at":"2025-05-28T13:31:41.717Z","personalization_survey_n8n_version":"1.94.1"},"settings":{"userActivated":true,"easyAIWorkflowOnboarded":true,"firstSuccessfulWorkflowId":"fN5uSWvKRujKur6R","userActivatedAt":1757621781409,"npsSurvey":{"responded":true,"lastShownAt":1749478378830},"dismissedCallouts":{"preBuiltAgentsCalloutHttpRequest":true,"preBuiltAgentsCalloutGoogleDrive":true,"preBuiltAgentsModalCallout":true,"preBuiltAgentsCallout":true}},"disabled":false,"mfaEnabled":false,"lastActiveAt":"2025-10-08","isPending":false}}]}}],"tags":[{"createdAt":"2025-05-28T13:35:47.754Z","updatedAt":"2025-05-28T13:35:47.754Z","id":"1DfavlTBWEW637E1","name":"Davi Araujo"}]}