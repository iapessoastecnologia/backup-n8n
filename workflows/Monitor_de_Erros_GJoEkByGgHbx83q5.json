{"createdAt":"2025-07-30T12:17:39.155Z","id":"GJoEkByGgHbx83q5","name":"Monitor de Erros","active":true,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.errorTrigger","typeVersion":1,"position":[-656,0],"id":"e315dd01-1abc-4173-b4f3-74854d517beb","name":"Error Trigger"},{"parameters":{"resource":"message","guildId":{"__rl":true,"value":"1412776659505119316","mode":"list","cachedResultName":"Desenvolvimento - Dep IA","cachedResultUrl":"[REDACTED]"},"channelId":{"__rl":true,"value":"1425492829551067266","mode":"list","cachedResultName":"erros-n8n","cachedResultUrl":"[REDACTED]"},"content":"={{ $json.content }}","options":{}},"type":"n8n-nodes-base.discord","typeVersion":2,"position":[-208,0],"id":"72824148-e4b3-44cb-b07a-8e3a4df979f6","name":"Send a message","webhookId":"7afc0727-ec71-4101-b36b-93a5f48105c4"},{"parameters":{"jsCode":"const exec = $json.execution || {};\nconst wf = $json.workflow || {};\nconst err = exec.error || {};\n\n// 🔹 Truncar mensagens muito grandes (Discord = 2000 chars máx)\nfunction truncar(texto, limite = 1800) {\n  if (!texto) return '';\n  return texto.length > limite ? texto.substring(0, limite) + ' [...]' : texto;\n}\n\n// 🔹 Corrigir URL (substitui 'webhook' por 'n8n')\nlet urlCorrigida = exec.url || '#';\nif (urlCorrigida.startsWith('https://webhook.')) {\n  urlCorrigida = urlCorrigida.replace('https://webhook.', 'https://n8n.');\n}\n\n// 🔹 Mensagem de alerta com menção de role\nconst cabecalho = `🚨 **Atenção <@&1412776735401054219>, novo erro de execução detectado!**\\n`;\n\nconst msg = `\n${cabecalho}\n⚠️ **Erro Detectado no n8n**\n─────────────────────────────\n🧠 **Workflow:** ${wf.name || 'Desconhecido'} (ID: ${wf.id || 'N/D'})\n💥 **Mensagem:** ${truncar(err.message, 300) || 'Sem descrição'}\n📍 **Último Nó:** ${exec.lastNodeExecuted || 'N/D'}\n♻️ **Retry Of:** ${exec.retryOf || 'N/A'}\n🧩 **Modo:** ${exec.mode || 'N/D'}\n🔗 **Execução:** [Abrir no n8n](${urlCorrigida})\n─────────────────────────────\n📜 **Stack (parcial):**\n\\`\\`\\`\n${truncar(err.stack, 1000) || 'Não informado'}\n\\`\\`\\`\n─────────────────────────────\n`;\n\nreturn [{ json: { content: msg || '⚠️ Nenhuma mensagem gerada pelo Code Node' } }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-416,0],"id":"7fd84a61-31b3-4058-91b2-b67468260725","name":"Code in JavaScript"}],"connections":{"Error Trigger":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"Send a message","type":"main","index":0}]]}}}